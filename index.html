<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>üêÇ Corrida bulloise üèÉ‚Äç‚ôÇÔ∏è</title>
    <!-- Inclusion de Chart.js depuis un CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Inclusion de la police 'Roboto' depuis Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Styles g√©n√©raux */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f3f5;
        }

        header {
            background-color: #34495e;
            color: #ecf0f1;
            padding: 20px 10px;
            text-align: center;
        }

        h1 {
            margin: 0;
            font-size: 2.5em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        h1 span {
            margin: 0 10px;
        }

        /* Styles pour les onglets */
        .tab {
            overflow: hidden;
            background-color: #2c3e50;
            display: flex;
            flex-wrap: wrap;
        }

        .tab button {
            background-color: inherit;
            color: #ecf0f1;
            padding: 14px 16px;
            border: none;
            cursor: pointer;
            font-size: 17px;
            flex-grow: 1;
            text-align: center;
            transition: background-color 0.3s;
        }

        .tab button:hover {
            background-color: #1abc9c;
        }

        .tab button.active {
            background-color: #16a085;
        }

        /* Styles pour le contenu des onglets */
        .tabcontent {
            display: none;
            padding: 20px;
            background-color: #fff;
        }

        .tabcontent.active {
            display: block;
        }

        /* Styles pour les s√©ances */
        .session {
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            overflow: hidden;
        }

        .session h3 {
            background-color: #2980b9;
            color: #fff;
            margin: 0;
            padding: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 1.1em;
        }

        .session h3 span {
            margin-right: 10px;
        }

        .details {
            display: none;
            padding: 10px;
            background-color: #ecf0f1;
        }

        /* Styles pour l'√©dition */
        .edit-button, .save-button, .cancel-button, .delete-button {
            margin: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.9em;
            border: none;
            border-radius: 3px;
        }

        .edit-button {
            background-color: #e67e22;
            color: #fff;
        }

        .save-button {
            background-color: #27ae60;
            color: #fff;
        }

        .cancel-button {
            background-color: #95a5a6;
            color: #fff;
        }

        .delete-button {
            background-color: #c0392b;
            color: #fff;
        }

        /* Styles pour le formulaire d'√©dition */
        .edit-form input, .edit-form textarea {
            width: 100%;
            padding: 5px;
            margin-bottom: 5px;
        }

        .edit-form label {
            font-weight: bold;
        }

        /* Styles pour l'analyse */
        .analysis-section {
            margin-top: 20px;
            border-top: 1px solid #ccc;
            padding-top: 20px;
        }

        .analysis-input label {
            display: block;
            margin-bottom: 5px;
        }

        .analysis-input input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }

        .analyze-button, .reset-button {
            padding: 10px 20px;
            background-color: #e67e22;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 1em;
            width: 48%;
            margin-top: 10px;
            border-radius: 5px;
        }

        .reset-button {
            background-color: #c0392b;
        }

        .button-group {
            display: flex;
            justify-content: space-between;
        }

        .chart-container {
            margin-top: 30px;
        }

        .session-counter {
            margin-top: 20px;
            font-size: 1.2em;
            color: #2c3e50;
        }

        /* Responsive */
        @media (max-width: 600px) {
            h1 {
                font-size: 1.8em;
            }

            .tab button {
                font-size: 14px;
                padding: 10px;
            }

            .analyze-button, .reset-button {
                font-size: 0.9em;
                width: 100%;
                margin-bottom: 10px;
            }

            .button-group {
                flex-direction: column;
            }

            .session h3 {
                font-size: 1em;
            }
        }

        /* Ajustements sp√©cifiques pour l'iPhone 11 */
        @media only screen and (max-device-width: 414px) and (orientation: portrait) {
            .tab button {
                padding: 12px;
                font-size: 16px;
            }

            h1 {
                font-size: 2em;
            }

            .session h3 {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>

<header>
    <h1><span>üêÇ</span>Corrida bulloise<span>üèÉ‚Äç‚ôÇÔ∏è</span></h1>
</header>

<!-- Onglets -->
<div class="tab">
    <button class="tablinks active" onclick="openTab(event, 'Semaine1')">Semaine 1</button>
    <button class="tablinks" onclick="openTab(event, 'Semaine2')">Semaine 2</button>
    <button class="tablinks" onclick="openTab(event, 'Semaine3')">Semaine 3</button>
    <button class="tablinks" onclick="openTab(event, 'Semaine4')">Semaine 4</button>
    <button class="tablinks" onclick="openTab(event, 'Semaine5')">Semaine 5</button>
    <button class="tablinks" onclick="openTab(event, 'Analyse')">Analyse</button>
</div>

<!-- Contenu des onglets -->

<!-- Semaine 1 -->
<div id="Semaine1" class="tabcontent active">
    <h2>Semaine 1 (13 - 19 octobre)</h2>
    <h3>Total approximatif : 23 km</h3>
    <button class="edit-button" onclick="addSession('Semaine1')">Ajouter une s√©ance</button>
    <div id="sessionsSemaine1"></div>
</div>

<!-- Semaine 2 -->
<div id="Semaine2" class="tabcontent">
    <h2>Semaine 2 (20 - 26 octobre)</h2>
    <h3>Total approximatif : 26 km</h3>
    <button class="edit-button" onclick="addSession('Semaine2')">Ajouter une s√©ance</button>
    <div id="sessionsSemaine2"></div>
</div>

<!-- Semaine 3 -->
<div id="Semaine3" class="tabcontent">
    <h2>Semaine 3 (27 octobre - 2 novembre)</h2>
    <h3>Total approximatif : 31 km</h3>
    <button class="edit-button" onclick="addSession('Semaine3')">Ajouter une s√©ance</button>
    <div id="sessionsSemaine3"></div>
</div>

<!-- Semaine 4 -->
<div id="Semaine4" class="tabcontent">
    <h2>Semaine 4 (3 - 9 novembre)</h2>
    <h3>Total approximatif : 32 km</h3>
    <button class="edit-button" onclick="addSession('Semaine4')">Ajouter une s√©ance</button>
    <div id="sessionsSemaine4"></div>
</div>

<!-- Semaine 5 -->
<div id="Semaine5" class="tabcontent">
    <h2>Semaine 5 (10 - 16 novembre)</h2>
    <h3>Total approximatif : 23 km (incluant la course)</h3>
    <button class="edit-button" onclick="addSession('Semaine5')">Ajouter une s√©ance</button>
    <div id="sessionsSemaine5"></div>
</div>

<!-- Analyse -->
<div id="Analyse" class="tabcontent">
    <h2>Analyse de l'Entra√Ænement</h2>

    <!-- Section pour le temps pass√© dans les zones cardiaques -->
    <div class="analysis-section">
        <div class="session-counter">
            <p>Derni√®re s√©ance ajout√©e : <span id="lastZoneSession">Aucune s√©ance ajout√©e</span></p>
        </div>
        <div class="analysis-input">
            <h3>Temps pass√© dans chaque zone cardiaque :</h3>
            <label for="zone1">Zone 1 (hh:mm:ss) :</label>
            <input type="text" id="zone1" placeholder="hh:mm:ss">
            <label for="zone2">Zone 2 (hh:mm:ss) :</label>
            <input type="text" id="zone2" placeholder="hh:mm:ss">
            <label for="zone3">Zone 3 (hh:mm:ss) :</label>
            <input type="text" id="zone3" placeholder="hh:mm:ss">
            <label for="zone4">Zone 4 (hh:mm:ss) :</label>
            <input type="text" id="zone4" placeholder="hh:mm:ss">
            <label for="zone5">Zone 5 (hh:mm:ss) :</label>
            <input type="text" id="zone5" placeholder="hh:mm:ss">
            <div class="button-group">
                <button class="analyze-button" onclick="addZoneSession()">Ajouter la s√©ance</button>
                <button class="reset-button" onclick="undoLastZoneSession()">Annuler la derni√®re entr√©e</button>
            </div>
        </div>
        <div class="chart-container">
            <canvas id="zoneChart"></canvas>
        </div>
    </div>

    <!-- Section pour les kilom√®tres parcourus par semaine -->
    <div class="analysis-section">
        <div class="session-counter">
            <p>Derni√®re s√©ance ajout√©e : <span id="lastKmSession">Aucune s√©ance ajout√©e</span></p>
        </div>
        <div class="analysis-input">
            <h3>Kilom√®tres parcourus par semaine :</h3>
            <label for="kmSemaine">Semaine (1-5) :</label>
            <input type="number" id="kmSemaine" placeholder="Num√©ro de la semaine (1-5)" min="1" max="5">
            <label for="kmParcourus">Kilom√®tres parcourus :</label>
            <input type="number" id="kmParcourus" placeholder="Nombre de kilom√®tres">
            <div class="button-group">
                <button class="analyze-button" onclick="addKmSession()">Ajouter les kilom√®tres</button>
                <button class="reset-button" onclick="undoLastKmSession()">Annuler la derni√®re entr√©e</button>
            </div>
        </div>
        <div class="chart-container">
            <canvas id="kmChart"></canvas>
        </div>
    </div>
</div>

<script>
    // Donn√©es initiales des s√©ances
    let sessionsData = {
        'Semaine1': [
            {
                title: '‚ù§Ô∏è Endurance Fondamentale - Mardi',
                details: '<p><strong>Contenu :</strong> 7 km en endurance fondamentale (zones 1-2).</p><p><strong>Objectif :</strong> Travailler l\'endurance de base.</p>'
            },
            {
                title: '‚ö° VMA Courte + Allure Course - Jeudi',
                details: '<p><strong>√âchauffement :</strong> 15 min en EF (~2 km).</p><p><strong>Exercice principal :</strong> 8 x 200 m √† 105% VMA (3:26 min/km) avec 1 min de r√©cup√©ration en trottinant.</p><p><strong>Allure Course :</strong> 1 km √† allure cible (4:03 min/km).</p><p><strong>Retour au calme :</strong> 10 min en EF (~1,5 km).</p><p><strong>Objectif :</strong> Am√©liorer la VMA et se familiariser avec l\'allure de course.</p>'
            },
            {
                title: 'üèÉ‚Äç‚ôÇÔ∏è Sortie Longue avec Allure de Course - Dimanche',
                details: '<p><strong>Contenu :</strong></p><ul><li>5 km en EF (zones 1-2)</li><li>2 km √† allure de course (4:03 min/km)</li><li>10 min de retour au calme en EF (~1,5 km)</li></ul><p><strong>Objectif :</strong> Habituer le corps √† l\'allure de course en fin de sortie longue et r√©cup√©rer activement.</p>'
            }
        ],
        // Donn√©es pour les autres semaines...
        // Semaine 2
        'Semaine2': [
            {
                title: '‚ù§Ô∏è Endurance Fondamentale - Mardi',
                details: '<p><strong>Contenu :</strong> 8 km en endurance fondamentale (zones 1-2).</p><p><strong>Objectif :</strong> Travailler l\'endurance de base.</p>'
            },
            {
                title: '‚ö° VMA Courte - Jeudi',
                details: '<p><strong>√âchauffement :</strong> 15 min en EF (~2 km).</p><p><strong>Exercice principal :</strong> 8 x 400 m √† 100% VMA (3:37 min/km) avec 1 min de r√©cup√©ration en trottinant.</p><p><strong>Retour au calme :</strong> 10 min en EF (~1,5 km).</p><p><strong>Objectif :</strong> Am√©liorer la VMA et la capacit√© a√©robie.</p>'
            },
            {
                title: 'üèÉ‚Äç‚ôÇÔ∏è Sortie Longue avec Allure Sp√©cifique - Dimanche',
                details: '<p><strong>Contenu :</strong></p><ul><li>4 km en EF (zones 1-2)</li><li>2 x 2 km √† allure sp√©cifique (4:03 min/km) avec 2 minutes de r√©cup√©ration</li><li>10 min de retour au calme en EF (~1,5 km)</li></ul><p><strong>Objectif :</strong> Habituer votre corps √† l\'allure de course et r√©cup√©rer activement.</p>'
            }
        ],
        // Semaine 3
        'Semaine3': [
            {
                title: '‚ù§Ô∏è Endurance Fondamentale - Mardi',
                details: '<p><strong>Contenu :</strong> 9 km en endurance fondamentale (zones 1-2) √† 6\'00" - 6\'15"/km.</p><p><strong>Objectif :</strong> Augmenter l√©g√®rement le volume tout en travaillant l\'endurance de base.</p>'
            },
            {
                title: '‚ö° Intervalles Moyens - Jeudi',
                details: '<p><strong>√âchauffement :</strong> 15 min en EF (~2,5 km) √† 6\'00"/km.</p><p><strong>Exercice principal :</strong></p><ul><li>6 x 600 m √† 95-100% VMA (entre 3\'36" et 3\'48"/km)</li><li>R√©cup√©ration : 1\'30" en trottinant (~200 m) entre chaque r√©p√©tition</li></ul><p><strong>Retour au calme :</strong> 10 min en EF (~1,5 km) √† 7\'00"/km.</p><p><strong>Objectif :</strong> Travailler la VMA longue et la capacit√© √† maintenir une allure rapide sur une distance plus longue.</p>'
            },
            {
                title: 'üèÉ‚Äç‚ôÇÔ∏è Sortie Longue avec Allure Sp√©cifique - Dimanche',
                details: '<p><strong>Contenu :</strong></p><ul><li>8 km en EF (zones 1-2) √† 6\'00" - 6\'15"/km</li><li>3 x 1 km √† allure sp√©cifique (4\'03"/km) avec 2 min de r√©cup√©ration en trottinant</li><li>10 min de retour au calme en EF (~1,5 km) √† 7\'00"/km</li></ul><p><strong>Objectif :</strong> Maintenir un travail √† allure sp√©cifique sans accumuler trop de fatigue avant la s√©ance test.</p>'
            }
        ],
        // Semaine 4
        'Semaine4': [
            {
                title: 'üìù S√©ance de Fractionn√© Test - Mardi',
                details: '<p><strong>√âchauffement :</strong> 15 min en EF (~2,5 km) √† 6\'00"/km, suivies de gammes et acc√©l√©rations.</p><p><strong>Exercice principal :</strong></p><ul><li>3 000 m √† allure cible (4\'03"/km)</li><li>R√©cup√©ration : 1\'30" en footing (~200 m)</li><li>2 000 m √† allure cible</li><li>R√©cup√©ration : 1\'30" en footing (~200 m)</li><li>1 000 m √† allure cible</li></ul><p><strong>Retour au calme :</strong> 10 min en EF (~1,5 km) √† 7\'00"/km.</p><p><strong>Objectif :</strong> Valider votre allure de course et simuler la gestion de l\'effort.</p>'
            },
            {
                title: '‚ù§Ô∏è Endurance Fondamentale - Jeudi',
                details: '<p><strong>Contenu :</strong> 8 km en endurance fondamentale (zones 1-2) √† 6\'00" - 6\'15"/km.</p><p><strong>Objectif :</strong> Favoriser la r√©cup√©ration active apr√®s la s√©ance test.</p>'
            },
            {
                title: 'üå≥ Sortie Longue L√©g√®re - Dimanche',
                details: '<p><strong>Contenu :</strong> 10 km en endurance fondamentale √† 6\'00" - 6\'15"/km.</p><p><strong>Objectif :</strong> Maintenir l\'endurance sans accumuler de fatigue avant la phase de r√©duction.</p>'
            }
        ],
        // Semaine 5
        'Semaine5': [
            {
                title: '‚ú® Footing avec Rappel d\'Allure - Mardi',
                details: '<p><strong>√âchauffement :</strong> 15 min en EF (~2,5 km) √† 6\'00"/km.</p><p><strong>Exercice principal :</strong></p><ul><li>3 x 500 m √† allure sp√©cifique (4\'03"/km) avec 2 min de r√©cup√©ration en trottinant</li></ul><p><strong>Retour au calme :</strong> 10 min en EF (~1,5 km) √† 7\'00"/km.</p><p><strong>Objectif :</strong> Maintenir la vivacit√© et l\'allure cible sans g√©n√©rer de fatigue.</p>'
            },
            {
                title: 'üõå Endurance Fondamentale Courte - Jeudi',
                details: '<p><strong>Contenu :</strong> 5 km en endurance fondamentale √† 6\'15"/km.</p><p><strong>Objectif :</strong> Favoriser la r√©cup√©ration et la fra√Æcheur musculaire.</p>'
            },
            {
                title: 'üèÖ Corrida Bulloise - Dimanche',
                details: '<p><strong>√âchauffement Avant la Course :</strong></p><ul><li>15 min en EF (~2,5 km) √† 6\'00"/km</li><li>Quelques acc√©l√©rations progressives pour pr√©parer le corps</li></ul><p><strong>Course :</strong></p><ul><li>Distance : 8,4 km</li><li>Allure cible : 4\'03"/km</li></ul><p><strong>Conseil :</strong> G√©rez bien votre √©nergie, suivez votre allure d√®s le d√©part et profitez de l\'ambiance pour vous d√©passer. Bonne chance‚ÄØ!</p>'
            }
        ]
    };

    // Fonction pour afficher les s√©ances
    function displaySessions(semaineId) {
        const sessionsContainer = document.getElementById('sessions' + semaineId);
        sessionsContainer.innerHTML = '';
        const sessions = sessionsData[semaineId] || [];
        sessions.forEach((session, index) => {
            const sessionDiv = document.createElement('div');
            sessionDiv.className = 'session';

            const h3 = document.createElement('h3');
            h3.innerHTML = `<span>${session.title.split(' ')[0]}</span>${session.title.split(' ').slice(1).join(' ')}`;
            h3.onclick = () => {
                detailsDiv.style.display = detailsDiv.style.display === 'block' ? 'none' : 'block';
            };

            const detailsDiv = document.createElement('div');
            detailsDiv.className = 'details';
            detailsDiv.innerHTML = session.details;

            const editBtn = document.createElement('button');
            editBtn.className = 'edit-button';
            editBtn.textContent = 'Modifier';
            editBtn.onclick = () => editSession(semaineId, index, sessionDiv);

            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-button';
            deleteBtn.textContent = 'Supprimer';
            deleteBtn.onclick = () => deleteSession(semaineId, index);

            sessionDiv.appendChild(h3);
            sessionDiv.appendChild(detailsDiv);
            sessionDiv.appendChild(editBtn);
            sessionDiv.appendChild(deleteBtn);

            sessionsContainer.appendChild(sessionDiv);
        });
    }

    // Initialiser l'affichage des s√©ances
    function initSessions() {
        for (let i = 1; i <= 5; i++) {
            displaySessions('Semaine' + i);
        }
    }

    // Fonction pour modifier une s√©ance
    function editSession(semaineId, index, sessionDiv) {
        const session = sessionsData[semaineId][index];
        sessionDiv.innerHTML = '';

        const form = document.createElement('div');
        form.className = 'edit-form';

        const titleLabel = document.createElement('label');
        titleLabel.textContent = 'Titre :';
        const titleInput = document.createElement('input');
        titleInput.type = 'text';
        titleInput.value = session.title;

        const detailsLabel = document.createElement('label');
        detailsLabel.textContent = 'D√©tails :';
        const detailsTextarea = document.createElement('textarea');
        detailsTextarea.rows = 10;
        detailsTextarea.value = session.details.replace(/<\/?p>/g, '').replace(/<\/?ul>/g, '').replace(/<\/?li>/g, '');

        const saveBtn = document.createElement('button');
        saveBtn.className = 'save-button';
        saveBtn.textContent = 'Enregistrer';
        saveBtn.onclick = () => {
            session.title = titleInput.value;
            session.details = detailsTextarea.value;
            saveData();
            displaySessions(semaineId);
        };

        const cancelBtn = document.createElement('button');
        cancelBtn.className = 'cancel-button';
        cancelBtn.textContent = 'Annuler';
        cancelBtn.onclick = () => {
            displaySessions(semaineId);
        };

        form.appendChild(titleLabel);
        form.appendChild(titleInput);
        form.appendChild(detailsLabel);
        form.appendChild(detailsTextarea);
        form.appendChild(saveBtn);
        form.appendChild(cancelBtn);

        sessionDiv.appendChild(form);
    }

    // Fonction pour ajouter une s√©ance
    function addSession(semaineId) {
        const sessions = sessionsData[semaineId] || [];
        sessions.push({
            title: 'Nouvelle S√©ance',
            details: '<p><strong>Contenu :</strong></p><p><strong>Objectif :</strong></p>'
        });
        sessionsData[semaineId] = sessions;
        saveData();
        displaySessions(semaineId);
    }

    // Fonction pour supprimer une s√©ance
    function deleteSession(semaineId, index) {
        if (confirm('√ätes-vous s√ªr de vouloir supprimer cette s√©ance ?')) {
            sessionsData[semaineId].splice(index, 1);
            saveData();
            displaySessions(semaineId);
        }
    }

    // Gestion des onglets
    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName('tabcontent');
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].classList.remove('active');
        }
        tablinks = document.getElementsByClassName('tablinks');
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove('active');
        }
        document.getElementById(tabName).classList.add('active');
        evt.currentTarget.classList.add('active');
    }

    // Sauvegarder les donn√©es dans le Local Storage
    function saveData() {
        localStorage.setItem('sessionsData', JSON.stringify(sessionsData));
        localStorage.setItem('zoneSessionHistory', JSON.stringify(zoneSessionHistory));
        localStorage.setItem('kmSessionHistory', JSON.stringify(kmSessionHistory));
        localStorage.setItem('cumulativeZones', JSON.stringify({
            cumulativeZone1,
            cumulativeZone2,
            cumulativeZone3,
            cumulativeZone4,
            cumulativeZone5
        }));
        localStorage.setItem('kmPerWeek', JSON.stringify(kmPerWeek));
    }

    // Charger les donn√©es depuis le Local Storage
    function loadData() {
        const sessionsDataString = localStorage.getItem('sessionsData');
        if (sessionsDataString) {
            sessionsData = JSON.parse(sessionsDataString);
        }
        initSessions();

        // Charger les donn√©es d'analyse
        const cumulativeZonesString = localStorage.getItem('cumulativeZones');
        if (cumulativeZonesString) {
            const cumulativeZones = JSON.parse(cumulativeZonesString);
            cumulativeZone1 = cumulativeZones.cumulativeZone1 || 0;
            cumulativeZone2 = cumulativeZones.cumulativeZone2 || 0;
            cumulativeZone3 = cumulativeZones.cumulativeZone3 || 0;
            cumulativeZone4 = cumulativeZones.cumulativeZone4 || 0;
            cumulativeZone5 = cumulativeZones.cumulativeZone5 || 0;
        }

        const zoneSessionHistoryString = localStorage.getItem('zoneSessionHistory');
        if (zoneSessionHistoryString) {
            zoneSessionHistory = JSON.parse(zoneSessionHistoryString);
        }

        const kmPerWeekString = localStorage.getItem('kmPerWeek');
        if (kmPerWeekString) {
            kmPerWeek = JSON.parse(kmPerWeekString);
        }

        const kmSessionHistoryString = localStorage.getItem('kmSessionHistory');
        if (kmSessionHistoryString) {
            kmSessionHistory = JSON.parse(kmSessionHistoryString);
        }

        // Mettre √† jour l'affichage de la derni√®re s√©ance de zones
        if (zoneSessionHistory.length > 0) {
            const lastZoneSession = zoneSessionHistory[zoneSessionHistory.length - 1];
            document.getElementById('lastZoneSession').innerText = lastZoneSession.dateAdded;
        } else {
            document.getElementById('lastZoneSession').innerText = "Aucune s√©ance ajout√©e";
        }

        // Mettre √† jour l'affichage de la derni√®re s√©ance de kilom√®tres
        if (kmSessionHistory.length > 0) {
            const lastKmSession = kmSessionHistory[kmSessionHistory.length - 1];
            document.getElementById('lastKmSession').innerText = lastKmSession.dateAdded;
        } else {
            document.getElementById('lastKmSession').innerText = "Aucune s√©ance ajout√©e";
        }

        updateZoneChart();
        updateKmChart();
    }

    // Variables pour stocker les temps cumul√©s
    let cumulativeZone1 = 0;
    let cumulativeZone2 = 0;
    let cumulativeZone3 = 0;
    let cumulativeZone4 = 0;
    let cumulativeZone5 = 0;
    let zoneSessionHistory = [];

    // Variables pour les kilom√®tres par semaine
    let kmPerWeek = [0, 0, 0, 0, 0];
    let kmSessionHistory = [];

    // Fonction pour convertir hh:mm:ss en secondes
    function timeStringToSeconds(timeString) {
        if (!timeString || timeString.trim() === '') return 0;
        const parts = timeString.split(':');
        let seconds = 0;
        if (parts.length === 3) {
            seconds = (+parts[0]) * 3600 + (+parts[1]) * 60 + (+parts[2]);
        } else if (parts.length === 2) {
            seconds = (+parts[0]) * 60 + (+parts[1]);
        } else if (parts.length === 1) {
            seconds = +parts[0];
        }
        return seconds;
    }

    // Fonction pour convertir des secondes en hh:mm:ss
    function secondsToTimeString(seconds) {
        const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
        const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
        const s = (seconds % 60).toString().padStart(2, '0');
        return `${h}:${m}:${s}`;
    }

    // Fonction pour formater la date en "dd.mm.yyyy √† hh:mm"
    function formatDate(date) {
        const day = date.getDate().toString().padStart(2, '0');
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const year = date.getFullYear();
        const hours = date.getHours().toString().padStart(2, '0');
        const minutes = date.getMinutes().toString().padStart(2, '0');
        return `${day}.${month}.${year} √† ${hours}:${minutes}`;
    }

    // Fonction pour ajouter une s√©ance de zones cardiaques
    function addZoneSession() {
        const zone1Input = document.getElementById('zone1').value;
        const zone2Input = document.getElementById('zone2').value;
        const zone3Input = document.getElementById('zone3').value;
        const zone4Input = document.getElementById('zone4').value;
        const zone5Input = document.getElementById('zone5').value;

        const zone1 = timeStringToSeconds(zone1Input) || 0;
        const zone2 = timeStringToSeconds(zone2Input) || 0;
        const zone3 = timeStringToSeconds(zone3Input) || 0;
        const zone4 = timeStringToSeconds(zone4Input) || 0;
        const zone5 = timeStringToSeconds(zone5Input) || 0;

        const total = zone1 + zone2 + zone3 + zone4 + zone5;

        if (total === 0) {
            alert("Veuillez entrer des valeurs pour le temps pass√© dans les zones.");
            return;
        }

        // Ajouter les temps √† la somme cumulative
        cumulativeZone1 += zone1;
        cumulativeZone2 += zone2;
        cumulativeZone3 += zone3;
        cumulativeZone4 += zone4;
        cumulativeZone5 += zone5;

        // Obtenir la date et l'heure actuelles
        const now = new Date();
        const formattedDate = formatDate(now);

        // Ajouter la s√©ance √† l'historique avec la date
        zoneSessionHistory.push({
            zone1,
            zone2,
            zone3,
            zone4,
            zone5,
            dateAdded: formattedDate
        });

        // Mettre √† jour l'affichage de la derni√®re s√©ance
        document.getElementById('lastZoneSession').innerText = formattedDate;

        // R√©initialiser les champs d'entr√©e
        document.getElementById('zone1').value = '';
        document.getElementById('zone2').value = '';
        document.getElementById('zone3').value = '';
        document.getElementById('zone4').value = '';
        document.getElementById('zone5').value = '';

        // Sauvegarder les donn√©es
        saveData();

        // Mettre √† jour les graphiques
        updateZoneChart();
    }

    // Fonction pour annuler la derni√®re s√©ance de zones cardiaques
    function undoLastZoneSession() {
        if (zoneSessionHistory.length === 0) {
            alert("Aucune s√©ance √† annuler.");
            return;
        }

        const lastSession = zoneSessionHistory.pop();

        cumulativeZone1 -= lastSession.zone1;
        cumulativeZone2 -= lastSession.zone2;
        cumulativeZone3 -= lastSession.zone3;
        cumulativeZone4 -= lastSession.zone4;
        cumulativeZone5 -= lastSession.zone5;

        // Mettre √† jour l'affichage de la derni√®re s√©ance
        if (zoneSessionHistory.length > 0) {
            const previousSession = zoneSessionHistory[zoneSessionHistory.length - 1];
            document.getElementById('lastZoneSession').innerText = previousSession.dateAdded;
        } else {
            document.getElementById('lastZoneSession').innerText = "Aucune s√©ance ajout√©e";
        }

        // Sauvegarder les donn√©es
        saveData();

        updateZoneChart();
    }

    // Fonction pour ajouter une s√©ance de kilom√®tres
    function addKmSession() {
        const kmSemaineInput = parseInt(document.getElementById('kmSemaine').value);
        const kmParcourusInput = parseFloat(document.getElementById('kmParcourus').value);

        if (isNaN(kmParcourusInput) || isNaN(kmSemaineInput)) {
            alert("Veuillez entrer un num√©ro de semaine valide et des kilom√®tres parcourus.");
            return;
        }

        if (kmSemaineInput < 1 || kmSemaineInput > 5) {
            alert("Le num√©ro de semaine doit √™tre entre 1 et 5.");
            return;
        }

        // Ajouter les kilom√®tres √† la semaine correspondante
        kmPerWeek[kmSemaineInput - 1] += kmParcourusInput;

        // Obtenir la date et l'heure actuelles
        const now = new Date();
        const formattedDate = formatDate(now);

        // Ajouter la s√©ance √† l'historique avec la date
        kmSessionHistory.push({
            kmSemaine: kmSemaineInput,
            kmParcourus: kmParcourusInput,
            dateAdded: formattedDate
        });

        // Mettre √† jour l'affichage de la derni√®re s√©ance
        document.getElementById('lastKmSession').innerText = formattedDate;

        // R√©initialiser les champs d'entr√©e
        document.getElementById('kmSemaine').value = '';
        document.getElementById('kmParcourus').value = '';

        // Sauvegarder les donn√©es
        saveData();

        // Mettre √† jour le graphique
        updateKmChart();
    }

    // Fonction pour annuler la derni√®re s√©ance de kilom√®tres
    function undoLastKmSession() {
        if (kmSessionHistory.length === 0) {
            alert("Aucune entr√©e √† annuler.");
            return;
        }

        const lastSession = kmSessionHistory.pop();

        if (lastSession.kmSemaine >= 1 && lastSession.kmSemaine <= 5) {
            kmPerWeek[lastSession.kmSemaine - 1] -= lastSession.kmParcourus;
        }

        // Mettre √† jour l'affichage de la derni√®re s√©ance
        if (kmSessionHistory.length > 0) {
            const previousSession = kmSessionHistory[kmSessionHistory.length - 1];
            document.getElementById('lastKmSession').innerText = previousSession.dateAdded;
        } else {
            document.getElementById('lastKmSession').innerText = "Aucune s√©ance ajout√©e";
        }

        // Sauvegarder les donn√©es
        saveData();

        updateKmChart();
    }

    // Fonction pour mettre √† jour le graphique des zones
    function updateZoneChart() {
        const total = cumulativeZone1 + cumulativeZone2 + cumulativeZone3 + cumulativeZone4 + cumulativeZone5;

        if (total === 0) {
            if (window.zoneChartInstance) {
                window.zoneChartInstance.destroy();
            }
            return;
        }

        // Regroupement des zones
        const totalZone1_2 = cumulativeZone1 + cumulativeZone2;
        const totalZone3 = cumulativeZone3;
        const totalZone4_5 = cumulativeZone4 + cumulativeZone5;

        const percentageZone1_2 = (totalZone1_2 / total) * 100;
        const percentageZone3 = (totalZone3 / total) * 100;
        const percentageZone4_5 = (totalZone4_5 / total) * 100;

        // Conversion des temps en hh:mm:ss
        const timeZone1_2 = secondsToTimeString(totalZone1_2);
        const timeZone3 = secondsToTimeString(totalZone3);
        const timeZone4_5 = secondsToTimeString(totalZone4_5);

        // Afficher le graphique des zones
        const ctxZone = document.getElementById('zoneChart').getContext('2d');
        if (window.zoneChartInstance) {
            window.zoneChartInstance.destroy();
        }
        window.zoneChartInstance = new Chart(ctxZone, {
            type: 'bar',
            data: {
                labels: ['Zone 1-2', 'Zone 3', 'Zone 4-5'],
                datasets: [{
                    label: '% du temps pass√©',
                    data: [percentageZone1_2.toFixed(1), percentageZone3.toFixed(1), percentageZone4_5.toFixed(1)],
                    backgroundColor: [
                        '#1abc9c',
                        '#f1c40f',
                        '#e74c3c'
                    ],
                    borderColor: [
                        '#16a085',
                        '#f39c12',
                        '#c0392b'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                interaction: {
                    mode: 'nearest',
                    intersect: true
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let index = context.dataIndex;
                                let percentage = context.parsed.y.toFixed(1) + '%';
                                let time = '';
                                if (index === 0) {
                                    time = timeZone1_2;
                                } else if (index === 1) {
                                    time = timeZone3;
                                } else if (index === 2) {
                                    time = timeZone4_5;
                                }
                                return `${percentage} (${time})`;
                            }
                        }
                    },
                    title: {
                        display: true,
                        text: 'R√©partition du temps par zone cardiaque (cumul√©)'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + "%";
                            }
                        }
                    }
                }
            }
        });
    }

    // Fonction pour mettre √† jour le graphique des kilom√®tres
    function updateKmChart() {
        const totalKm = kmPerWeek.reduce((a, b) => a + b, 0);
        if (totalKm === 0) {
            if (window.kmChartInstance) {
                window.kmChartInstance.destroy();
            }
            return;
        }

        const ctxKm = document.getElementById('kmChart').getContext('2d');
        if (window.kmChartInstance) {
            window.kmChartInstance.destroy();
        }
        window.kmChartInstance = new Chart(ctxKm, {
            type: 'bar',
            data: {
                labels: ['Semaine 1', 'Semaine 2', 'Semaine 3', 'Semaine 4', 'Semaine 5'],
                datasets: [{
                    label: 'Kilom√®tres parcourus',
                    data: kmPerWeek,
                    backgroundColor: '#3498db',
                    borderColor: '#2980b9',
                    borderWidth: 1
                }]
            },
            options: {
                plugins: {
                    title: {
                        display: true,
                        text: 'Kilom√®tres parcourus par semaine'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value + " km";
                            }
                        }
                    }
                }
            }
        });
    }

    // Initialisation
    window.onload = function() {
        loadData();
    };
</script>

</body>
</html>
